- name: install php7.0-fpm
  apt: pkg={{ item }} state=installed update_cache=true
  with_items:
   - php7.0-fpm
   - php7.0-cli
   - php7.0-mysql
   - php7.0-curl
   - php7.0-mcrypt
   - php7.0-mbstring
   - php7.0-common
   - php7.0-gd
   - php7.0-soap
   - php7.0-zip
   - php7.0-bcmath
   - php7.0-xml
   - php7.0-sqlite3

- name: tweak php.ini configuration (cli)
  lineinfile:
    dest: /etc/php/7.0/cli/php.ini
    regexp: "{{ item.regexp }}"
    line: "{{ item.line }}"
    backup: yes
    backrefs: yes
  with_items:
    - { regexp: '^max_execution_time =', line: 'max_execution_time = 600' }
    - { regexp: '^memory_limit =', line: 'memory_limit = 512M' }
    - { regexp: '^error_reporting =', line: 'error_reporting = E_ALL' }
    - { regexp: '^display_errors =', line: 'display_errors = On' }
    - { regexp: '^display_startup_errors', line: 'display_startup_errors = On' }
    - { regexp: '^post_max_size =', line: 'post_max_size = 128M' }
    - { regexp: '^upload_max_filesize', line: 'upload_max_filesize = 128M' }
    - { regexp: '^;cgi.fix_pathinfo', line: 'cgi.fix_pathinfo = 0' }

- name: tweak php.ini configuration (fpm)
  lineinfile:
    dest: /etc/php/7.0/fpm/php.ini
    regexp: "{{ item.regexp }}"
    line: "{{ item.line }}"
    backup: yes
    backrefs: yes
  with_items:
    - { regexp: '^max_execution_time =', line: 'max_execution_time = 600' }
    - { regexp: '^memory_limit =', line: 'memory_limit = 512M' }
    - { regexp: '^error_reporting =', line: 'error_reporting = E_ALL' }
    - { regexp: '^display_errors =', line: 'display_errors = On' }
    - { regexp: '^display_startup_errors', line: 'display_startup_errors = On' }
    - { regexp: '^post_max_size =', line: 'post_max_size = 128M' }
    - { regexp: '^upload_max_filesize', line: 'upload_max_filesize = 128M' }
    - { regexp: '^;cgi.fix_pathinfo', line: 'cgi.fix_pathinfo = 0' }

- name: restart php7.0-fpm
  service: name=php7.0-fpm enabled=yes state=restarted
